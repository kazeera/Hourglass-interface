#: import Label kivy.uix.label.Label
#: import Factory kivy.factory.Factory

<UploadTable>
    GridLayout:
        cols: 1
        size: root.width, root.height

        GridLayout:
            cols: 2

            Label:
                text: 'Name of Dataset'
                font_size: 20

            TextInput:
                id: datasetName
                multiline: False
                hint_text: 'Enter Text Here'
                font_size: 20
                on_text: root.update_name()

        UploadFilePopup:
            id_parameter: 'filepath_matrix'
            label_text: 'Numeric Matrix\nRows (samples) x columns (genes/features/parameters)'

        UploadFilePopup:
            id_parameter: 'filepath_rowann'
            label_text: 'Row Annotations\nFirst column must be row names of numeric matrix.'

        UploadFilePopup:
            id_parameter: 'filepath_colann'
            label_text: 'Column Annotations\nOptional. First column must be column names of numeric matrix.'

<UploadFilePopup>
    id: root.id_parameter

    Label:
        text_size: self.size
        font_size: 20
        halign: 'center'
        valign: 'middle'
        text: root.label_text
    Button:
        id: upload_button
        text: root.button_text
        font_size: app.text_size
        on_press: root.open_popup()

<FileChoosePopup>:
    title: "Choose a file"
    size_hint: .9, .9
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        FileChooser:
            id: filechooser
            on_selection: root.load(filechooser.selection)
            FileChooserIconLayout

        BoxLayout:
            size_hint: (1, 0.1)
            pos_hint: {'center_x': .5, 'center_y': .5}
            spacing: 20
            Button:
                text: "Cancel"
                on_release: root.dismiss()

<ComparisonTable>:
	GridLayout:
		cols:1
        # Label:
        #    text: "Custom Comparison = Filter by column name of feature/gene from numeric matrix table. We recommend copying and pasting directly to avoid misspellings."
		ScrollView:
			GridLayout:
				id: container
				cols: 1
				size_hint_y: None
				height: self.minimum_height
				row_force_default: True
				row_default_height: dp(26)
        GridLayout:
            cols:2
		    Button:
			    text: "Add a comparison (row)"
			    on_release: root.add_a_row()
                font_size: app.text_size
            Button:
			    text: "Remove first comparison (row)"
			    on_release: root.remove_a_row2()
                font_size: app.text_size

<ComparisonTableRow>:
    orientation: "horizontal"
    id: id_number2

    Label:
        # id: id_number2
        text: root.id_number2
        # on_press: root.remove_a_row()

    Spinner:
        id: main_comparison
        font_size: app.text_size
        values: app.getRowAnnCols()
        text: 'Comparison'
        ann: 'rowAnn'
        on_text: root.update_row_info()

    Spinner:
        id: subgroup
        font_size: app.text_size
        text: 'Subgroup'
        values: app.getRowAnnCols()
        ann: 'rowAnn'
        on_text: root.update_row_info()

    TextInput:
        id: custom_comparison
        hint_text: "Custom Comparison"
        multiline: False
        on_text: root.update_row_info()

    TextInput:
        id: filter
        hint_text: "Filter"
        multiline: False
        on_text: root.update_row_info()

<FeatureSets>
    TabbedPanel:
        size: root.width, root.height
        do_default_tab: False
        tab_width: 400

        TabbedPanelItem:
            text: '1. Define Sets and Super-sets'
            font_size: app.text_size
            FeatureTab1:

        TabbedPanelItem:
            text: '2. Pick Parameters'
            font_size: app.text_size
            FeatureTab2:


<FeatureTab1>
	GridLayout:
		cols:1

        Button:
            size_hint: .5,.5
            text: "New Group (Add a Row)"
            on_release: root.add_a_row()
            font_size: app.text_size

		ScrollView:
			GridLayout:
				id: container
				cols: 1
				size_hint_y: None
				height: self.minimum_height
				row_force_default: True
				row_default_height: dp(26)
				font_size: app.text_size


<FeatureTab1Row>
    orientation: "horizontal"

    TextInput:
        id: group_name
        hint_text: "Name of Group"
        multiline: False
        on_text: root.update_row_info()

    TextInput:
        id: group_list
        hint_text: "List of features (e.g. Gene1,Gene2,Gene3) or groups"
        on_text: root.update_row_info()


<FeatureTab2>
	GridLayout:
		cols:1
        ScrollView:
			GridLayout:
				id: container
				cols: 1
				size_hint_y: None
				height: self.minimum_height
				row_force_default: True
				row_default_height: dp(26)

<FeatureTab2Label>
    id: id_featuretab2
    orientation: 'horizontal'

    Label:
        id: feature
        text: root.label_text
        font_size: app.text_size

    TextInput:
        id: std_parameter
        hint_text: "Standard Parameter (required)"
        on_text: root.update_row_info()

    TextInput:
        id: alt_parameter
        hint_text: "Alternative Parameter"
        on_text: root.update_row_info()


<CustomizeColors>
    viewclass: 'CCBoxlayout'

    RecycleGridLayout:
        default_size: None, dp(56)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        # width: self.minimum_width # new
        multiselect: True
        touch_multiselect: True
        cols: 1


<CCBoxlayout>
    orientation: 'horizontal'

    CCButton:
        button_text: root.rowAnn_val


<CCButton>
    Button:
        id: color_button
        font_size: app.text_size
        text: root.button_text
        background_normal: ''
        background_color: root.button_color
        on_press: root.open_popup()


<ColorPopup>:
    title: 'Pick a Color'
    size_hint: .9, .9
    id: popupcolor
    auto_dismiss: False

    BoxLayout:
        orientation: 'vertical'

        ColorPicker:
            id: colorpicker
            size_hint: 1.0, 1.0

        Button:
            text: 'Select and Close Window'
            size_hint: 1.0, 0.2
            on_press: root.load(colorpicker)

<CustomCheckbox>
    CheckBox:
        active: root.check_box
    Label:
        font_size: app.text_size
        size_hint_x: 0.6
        text_size: self.size
        halign: 'left'
        valign: 'middle'
        text: root.label_text

<MyOption@SpinnerOption>:
    font_size: app.text_size

<SpinnerLabel>
    id: label
    text_size: self.size
    font_size: app.text_size
    halign: 'right'
    valign: 'middle'
    text: root.label_text
    font_size: app.text_size

<CustomSpinner>
    Label:
        text: root.label_text
        font_size: app.text_size
    AnchorLayout:
        Spinner:
            size_hint: .8, .4
            id: spinner
            text: root.initial_option
            font_size: app.text_size
            option_cls: Factory.get("MyOption")
            values: root.spinner_list
            on_text: root.clicked(root.id_parameter, spinner.text)

<AdvancedOptions>
    GridLayout:
        cols: 1
        size: root.width, root.height

        CustomSpinner:
            id: correlation_method
            label_text: 'Correlation Method'
            initial_option: 'pearson'
            spinner_list: ["pearson", "kendall", "spearman"]

        CustomSpinner:
            id: pval_test
            label_text: 'Test Method'
            initial_option: 't.test'
            spinner_list: ["t.test", "wilcox"]

        CustomSpinner:
            id: pval_label
            label_text: 'P-values Label'
            initial_option: 'stars'
            spinner_list: ["stars", "numbers"]

        CustomSpinner:
            id: paired_analysis_id
            label_text: 'Paired analysis column:'
            spinner_list: app.getRowAnnCols()
            ann: 'rowAnn'

        CustomCheckbox:
            id: do_survival_analysis
            label_text: 'Run survival analysis - pick columns from row annotations:'
            check_box: False

        CustomSpinner:
            id: surv_time_column
            label_text: 'Survival time column:'
            spinner_list: app.getRowAnnCols()
            ann: 'rowAnn'

        CustomSpinner:
            id: surv_status_column
            label_text: 'Censoring status (1=censored, 2=dead) column:'
            spinner_list: app.getRowAnnCols()
            ann: 'rowAnn'

        GridLayout:
            cols: 2
            CustomCheckbox:
                id: do_impute
                label_text: 'Run imputed version in parallel - impute NAs % around mean = '
                check_box: False
            AnchorLayout:
                TextInput:
                    size_hint: .3, .3
                    id: impute_with_mean
                    multiline: False
                    hint_text: 'Enter number between 0 and 100 \nhere (inclusive). Default: 5.'

<RunHourglass>
    GridLayout:
        size: root.width, root.height
        cols: 1

        CustomCheckbox:
            label_text: 'Quality Control Plots:'
            id: make_qc
            id_parameter: 'make_qc'
            color: 1,0,1,1
            check_box: False
        Label:

        CustomSpinner:
            id: colAnn1
            label_text: 'By.Parameter Column'
            spinner_list: app.getColAnnCols()
            ann: 'colAnn'

        CustomSpinner:
            id: colAnn2
            label_text: 'By.Feature Column'
            spinner_list: app.getColAnnCols()
            ann: 'colAnn'

        Label:
            text: '"Make Groups" Plots only:'
            halign: 'right'
            font_size: app.text_size
            # color: 1,0,1,1
        Label:

        CustomCheckbox:
            label_text: 'Individual boxplots'
            id: boxplot_indiv

        CustomCheckbox:
            label_text: 'Overview boxplots'
            id: boxplot_overview

        CustomCheckbox:
            label_text: 'Heatmaps'
            id: heatmap

        CustomCheckbox:
            label_text: 'Correlation plots'
            id: corrplot

        CustomCheckbox:
            label_text: 'Correlation scatter (features < 50)'
            id: corrscatt_overview
            id_parameter: 'corrscatt_overview'


        CustomCheckbox:
            label_text: 'p-value/fold-change heatmap'
            id: pval_FC_heatmap

        CustomCheckbox:
            label_text: 'Profile barplots'
            id: barplot

        #    text: 'Download hourglass settings'

        AnchorLayout:
            Button:
                size_hint: .5, .8
                text: 'Run hourglass'
                font_size: app.text_size
                background_color: [1, 1, 1, 0.4]
<Welcome>
    BoxLayout:
        orientation: "vertical"
        size: root.width, root.height
        padding: 50
        spacing: 20

        Image:
            source: 'icons/hourglass.gif'

        Label:
            text: 'Follow the tabs on the top to go through the workflow.'
            font_size: app.text_size
        Label:
            text: 'Hit the "Run" button at the end!'
            font_size: app.text_size

<KVTabLay>
    TabbedPanel:
        size: root.width, root.height
        do_default_tab: False
        tab_width: 300
        tab_height: 75
        font_size: app.text_size

        TabbedPanelItem:
            text: 'Welcome to hourglass'
            font_size: app.text_size
            Welcome:

        TabbedPanelItem:
            text: 'Upload Data'
            font_size: app.text_size
            UploadTable:

        TabbedPanelItem:
            text: 'Pick Comparisons'
            font_size: app.text_size
            ComparisonTable:

        TabbedPanelItem:
            text: 'Define Feature Sets'
            font_size: app.text_size
            FeatureSets:

        TabbedPanelItem:
            text: 'Customize Colours'
            font_size: app.text_size
            CustomizeColors:

        TabbedPanelItem:
            text: 'Advanced Options'
            font_size: app.text_size
            AdvancedOptions:

        # TabbedPanelItem:
        #    text: 'Data Explorer'

        TabbedPanelItem:
            text: 'Run hourglass'
            font_size: app.text_size
            RunHourglass: