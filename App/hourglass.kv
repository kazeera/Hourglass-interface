<UploadTable>
    GridLayout:
        cols: 1
        size: root.width, root.height

        GridLayout:
            cols: 2

            Label:
                text: 'Name of Dataset'

            TextInput:
                id: datasetName
                multiline: False
                hint_text: 'Enter Text Here'

        UploadFilePopup:
            id_parameter: 'filepath_matrix'
            label_text: 'Numeric Matrix\nRows (samples) x columns (genes/features/parameters)'

        UploadFilePopup:
            id_parameter: 'filepath_rowann'
            label_text: 'Row Annotations\nFirst column must be row names of numeric matrix.'

        UploadFilePopup:
            id_parameter: 'filepath_colann'
            label_text: 'Column Annotations\nOptional. First column must be column names of numeric matrix.'

<UploadFilePopup>
    id: root.id_parameter

    Label:
        text_size: self.size
        # font_size: app.text_size
        halign: 'center'
        valign: 'middle'
        text: root.label_text
    Button:
        id: upload_button
        text: root.button_text
        font_size: app.text_size
        on_press: root.open_popup()
        on_press: root.whats_the_button(root.id_parameter)

<FileChoosePopup>:
    title: "Choose a file"
    size_hint: .9, .9
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        FileChooser:
            id: filechooser
            on_selection: root.load(filechooser.selection)
            FileChooserIconLayout

        BoxLayout:
            size_hint: (1, 0.1)
            pos_hint: {'center_x': .5, 'center_y': .5}
            spacing: 20
            Button:
                text: "Cancel"
                on_release: root.dismiss()

<ComparisonTable>:
	GridLayout:
		cols:1
        Label:
            text: "Custom Comparison = Filter by column name of feature/gene from numeric matrix table. We recommend copying and pasting directly to avoid misspellings."
		ScrollView:
			GridLayout:
				id: container
				cols: 1
				size_hint_y: None
				height: self.minimum_height
				row_force_default: True
				row_default_height: dp(26)
        GridLayout:
            cols:2
		    Button:
			    text: "Add a comparison (row)"
			    on_release: root.add_a_row()
            Button:
			    text: "Remove first comparison (row)"
			    on_release: root.remove_a_row2()

<ComparisonTableRow>:
    orientation: "horizontal"
    id: id_number2

    Label:
        # id: id_number2
        text: root.id_number2
        # on_press: root.remove_a_row()

    Spinner:
        id: main_comparison
        font_size: app.text_size
        values: app.getRowAnnCols()
        text: 'Main Comparison'
        on_text: root.update_row_info()

    Spinner:
        id: subgroup
        font_size: app.text_size
        text: 'Subgroup'
        values: app.getRowAnnCols()
        on_text: root.update_row_info()

    TextInput:
        id: custom_comparison
        hint_text: "Custom Comparison"
        multiline: False
        on_text: root.update_row_info()

    TextInput:
        id: filter
        hint_text: "Filter"
        multiline: False
        on_text: root.update_row_info()

<CCBoxlayout>
    orientation: "horizontal"

    Label:
        text: root.rowAnn_col
        size: 200, 50
        size_hint: None, None

    CCButton:
        rowAnn_val: 'Value1'

    CCButton:
        rowAnn_val: 'Value2'

<CCButton> # todo If this is a BoxLayout, add a Button
    Button:
        id: color_button
        font_size: app.text_size
        size: 200, 50
        text: root.rowAnn_val
        size_hint: None, None
        background_normal: ''
        background_color: root.button_color
        on_press: root.open_popup()

<CustomizeColors>
    viewclass: 'CCBoxlayout'

    RecycleBoxLayout:
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'

<ColorPopup>:
    title: 'Pick a Color'
    size_hint: .9, .9
    id: popupcolor
    auto_dismiss: False

    BoxLayout:
        orientation: 'vertical'

        ColorPicker:
            id: colorpicker
            size_hint: 1.0, 1.0

        Button:
            text: 'Select and Close Window'
            size_hint: 1.0, 0.2
            on_press: root.load(colorpicker)

<CustomCheckbox>
    Label:
    CheckBox:
        active: root.check_box
    Label:
        font_size: app.text_size
        size_hint_x: 0.6
        text_size: self.size
        halign: 'left'
        valign: 'middle'
        text: root.label_text

<CustomSpinner>
    Label:
        id: label
        font_size: app.text_size
        text_size: self.size
        halign: 'right'
        valign: 'middle'
        text: root.label_text
    AnchorLayout:
        Spinner:
            size_hint: .8, .4
            id: spinner
            font_size: app.text_size
            text: root.initial_option
            values: root.spinner_list
            text_autoupdate: True
            on_text: root.clicked(root.id_parameter, spinner.text)

<AdvancedOptions>
    GridLayout:
        cols: 1
        size: root.width, root.height

        CustomSpinner:
            id_parameter: 'correlation_method'
            label_text: 'Correlation Method'
            initial_option: 'pearson'
            spinner_list: ["pearson", "kendall", "spearman"]

        CustomSpinner:
            id_parameter: 'pval_test'
            label_text: 'Test Method'
            initial_option: 't.test'
            spinner_list: ["t.test", "wilcox"]

        CustomSpinner:
            id_parameter: 'pval_label'
            label_text: 'P-values Label'
            initial_option: 'stars'
            spinner_list: ["stars", "numbers"]


        CustomSpinner:
            id_parameter: 'paired_analysis_id'
            label_text: 'Paired analysis column:'
            spinner_list: app.getRowAnnCols()

        CustomCheckbox:
            id_parameter: 'do_survival_analysis'
            label_text: 'Run survival analysis - pick columns from row annotations:'
            check_box: False

        CustomSpinner:
            id_parameter: 'surv_time_column'
            label_text: 'Survival time column:'
            spinner_list: app.getRowAnnCols()

        CustomSpinner:
            id_parameter: 'surv_status_column'
            label_text: 'Censoring status (1=censored, 2=dead) column:'
            spinner_list: app.getRowAnnCols()

        GridLayout:
            cols: 2
            CustomCheckbox:
                id_parameter: 'do_impute'
                label_text: 'Run imputed version in parallel - impute NAs % around mean = '
                check_box: False
            AnchorLayout:
                TextInput:
                    size_hint: .3, .3
                    id: impute_with_mean
                    multiline: False
                    hint_text: 'Enter number between 0 and 100 \nhere (inclusive). Default: 5.'

<RunHourglass>
    GridLayout:
        size: root.width, root.height
        cols: 1

        GridLayout:
            cols: 2

            CustomCheckbox:
                label_text: 'Quality Control Plots:'
                color: 1,0,1,1
                check_box: False
            Label:

            CustomSpinner:
                id_parameter: 'colAnn1'
                label_text: 'By.Parameter Column'
                spinner_list: app.getColAnnCols() #TODO populate with column names of column annotations

            CustomSpinner:
                id_parameter: 'colAnn2'
                label_text: 'By.Feature Column'
                spinner_list: app.getColAnnCols() #TODO populate with column names of column annotations

            Label:
            Label:

            Label:
                text: '"Make Groups" Plots only:'
                halign: 'right'
                font_size: app.text_size
                # color: 1,0,1,1
            Label:

            CustomCheckbox:
                label_text: 'Make individual boxplots'

            CustomCheckbox:
                label_text: 'Make overview boxplots'

            CustomCheckbox:
                label_text: 'Make heatmaps'

            CustomCheckbox:
                label_text: 'Make correlation plots'

            CustomCheckbox:
                label_text: 'Make correlation scatter plots (features < 50)'

            CustomCheckbox:
                label_text: 'Make individual correlation scatter plots (takes a long time)'
                check_box: False

            CustomCheckbox:
                label_text: 'Make p-value/fold-change heatmap'

            CustomCheckbox:
                label_text: 'Make profile (stacked) barplots'

            CustomCheckbox:
                label_text: 'Make profile (stacked) barplots'

            Label:
            Label:
            Button:
                text: 'Download hourglass settings'

        AnchorLayout:
            Button:
                size_hint: .5, .5
                text: 'Run hourglass'
                font_size: app.text_size
                # background_color: [1, 1, 1, 0.4]

<MakeGroups>
    TabbedPanel:
        size: root.width, root.height
        do_default_tab: False
        tab_width: 300

        TabbedPanelItem:
            text: '1. Name Groups'
        TabbedPanelItem:
            text: '2. Pick Relevant Features and Parameters'

<KVTabLay>
    TabbedPanel:
        size: root.width, root.height
        do_default_tab: False
        tab_width: 300
        tab_height: 75

        TabbedPanelItem:
            text: 'Customize Colours'
            CustomizeColors:

        TabbedPanelItem:
            text: 'Upload Data'
            UploadTable:

        TabbedPanelItem:
            text: 'Pick Comparisons'
            ComparisonTable:

        TabbedPanelItem:
            text: 'Make Groups'
            MakeGroups:

        TabbedPanelItem:
            text: 'Advanced Options'
            AdvancedOptions:

        TabbedPanelItem:
            text: 'Data Explorer'

        TabbedPanelItem:
            text: 'Run Hourglass'
            RunHourglass: